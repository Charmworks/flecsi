<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>flecsi: /home/flecsi/flecsi/flecsi/data/serial/sparse.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="small-flecsi.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">flecsi
   &#160;<span id="projectnumber">0.0(master)</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_688c864b7b93022ab3a371d21adf78fb.html">flecsi</a></li><li class="navelem"><a class="el" href="dir_e37f8bb81981d72df6422a26362081de.html">data</a></li><li class="navelem"><a class="el" href="dir_6a8ab9140ea5b3acc4c0e8ad528ba32a.html">serial</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">sparse.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="serial_2sparse_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*~--------------------------------------------------------------------------~*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *  @@@@@@@@  @@           @@@@@@   @@@@@@@@ @@</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * /@@/////  /@@          @@////@@ @@////// /@@</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * /@@       /@@  @@@@@  @@    // /@@       /@@</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * /@@@@@@@  /@@ @@///@@/@@       /@@@@@@@@@/@@</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * /@@////   /@@/@@@@@@@/@@       ////////@@/@@</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * /@@       /@@/@@//// //@@    @@       /@@/@@</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * /@@       @@@//@@@@@@ //@@@@@@  @@@@@@@@ /@@</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * //       ///  //////   //////  ////////  //</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * Copyright (c) 2016 Los Alamos National Laboratory, LLC</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * All rights reserved</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *~--------------------------------------------------------------------------~*/</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#ifndef flecsi_serial_sparse_h</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#define flecsi_serial_sparse_h</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;set&gt;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;unordered_set&gt;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">//----------------------------------------------------------------------------//</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">// POLICY_NAMESPACE must be defined before including storage_type.h!!!</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">// Using this approach allows us to have only one storage_type_t</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">// definintion that can be used by all data policies -&gt; code reuse...</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#define POLICY_NAMESPACE serial</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="storage__type_8h.html">flecsi/data/storage_type.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#undef POLICY_NAMESPACE</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">//----------------------------------------------------------------------------//</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="const__string_8h.html">flecsi/utils/const_string.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;flecsi/topology/index_space.h&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#define np(X)                                                            \</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor"> std::cout &lt;&lt; __FILE__ &lt;&lt; &quot;:&quot; &lt;&lt; __LINE__ &lt;&lt; &quot;: &quot; &lt;&lt; __PRETTY_FUNCTION__ \</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">           &lt;&lt; &quot;: &quot; &lt;&lt; #X &lt;&lt; &quot; = &quot; &lt;&lt; (X) &lt;&lt; std::endl</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceflecsi.html">flecsi</a> {</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="keyword">namespace </span>data {</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">namespace </span>serial {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">//+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=//</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">// Helper type definitions.</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">//+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=//</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">//----------------------------------------------------------------------------//</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">// Sparse accessor.</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">//----------------------------------------------------------------------------//</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">   61</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value__</a></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;{</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value__</a>(<span class="keywordtype">size_t</span> entry)</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  : entry(entry){}</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value__</a>(<span class="keywordtype">size_t</span> entry, T value)</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  : entry(entry),</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  value(value){}</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value__</a>(){}</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordtype">size_t</span> entry;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  T value;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;}; <span class="comment">// struct entry_value__</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="keyword">static</span> constexpr <span class="keywordtype">size_t</span> INDICES_FLAG = 1UL &lt;&lt; 63;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="keyword">static</span> constexpr <span class="keywordtype">size_t</span> ENTRIES_FLAG = 1UL &lt;&lt; 62;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> MD&gt;</div><div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="structflecsi_1_1data_1_1serial_1_1sparse__accessor__t.html">   92</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structflecsi_1_1data_1_1serial_1_1sparse__accessor__t.html">sparse_accessor_t</a></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;{</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="comment">//--------------------------------------------------------------------------//</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="comment">// Type definitions.</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="comment">//--------------------------------------------------------------------------//</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keyword">using</span> <a class="code" href="classflecsi_1_1utils_1_1iterator.html">iterator_t</a> = <a class="code" href="classflecsi_1_1utils_1_1iterator.html">utils::index_space_t::iterator_t</a>;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="keyword">using</span> meta_data_t = MD;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keyword">using</span> user_meta_data_t = <span class="keyword">typename</span> meta_data_t::user_meta_data_t;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="keyword">using</span> <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> = <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value__&lt;T&gt;</a>;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keyword">using</span> <a class="code" href="classflecsi_1_1topology_1_1index__space.html">index_space_</a> = </div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <a class="code" href="classflecsi_1_1topology_1_1index__space.html">topology::index_space&lt;topology::simple_entry&lt;size_t&gt;</a>, <span class="keyword">true</span>&gt;;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="comment">//--------------------------------------------------------------------------//</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="comment">// Constructors.</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="comment">//--------------------------------------------------------------------------//</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <a class="code" href="structflecsi_1_1data_1_1serial_1_1sparse__accessor__t.html">sparse_accessor_t</a>() {}</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <a class="code" href="structflecsi_1_1data_1_1serial_1_1sparse__accessor__t.html">sparse_accessor_t</a>(</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    meta_data_t &amp; meta_data,</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordtype">size_t</span> version</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  )</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  :</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  meta_data_(meta_data),</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  version_(version),</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  num_indices_(meta_data.size),</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  num_entries_(meta_data_.num_entries)</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  {</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keyword">auto</span> iitr = meta_data_.data.find(version | INDICES_FLAG);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    assert(iitr != meta_data_.data.end());</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    std::vector&lt;uint8_t&gt; &amp; raw_indices = </div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <span class="keyword">const_cast&lt;</span>std::vector&lt;uint8_t&gt; &amp;<span class="keyword">&gt;</span>(iitr-&gt;second);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    indices_ = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">size_t</span> *<span class="keyword">&gt;</span>(&amp;raw_indices[0]);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keyword">auto</span> mitr = meta_data_.data.find(version | ENTRIES_FLAG);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    assert(mitr != meta_data_.data.end());</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    std::vector&lt;uint8_t&gt; &amp; raw_entries = </div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      <span class="keyword">const_cast&lt;</span>std::vector&lt;uint8_t&gt; &amp;<span class="keyword">&gt;</span>(mitr-&gt;second);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    entries_ = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> *<span class="keyword">&gt;</span>(&amp;raw_entries[0]);      </div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  } <span class="comment">// sparse_accessor_t</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="comment">//--------------------------------------------------------------------------//</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="comment">// Member data interface.</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="comment">//--------------------------------------------------------------------------//</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  bitset_t &amp;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  attributes()</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">return</span> meta_data_.user_attributes_;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  } <span class="comment">// attributes</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="comment">//--------------------------------------------------------------------------//</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="comment">// Operators.</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="comment">//--------------------------------------------------------------------------//</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  T &amp;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  operator () (</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordtype">size_t</span> index,</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordtype">size_t</span> entry</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  )</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  {</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    assert(index &lt; num_indices_ &amp;&amp; <span class="stringliteral">&quot;sparse accessor: index out of bounds&quot;</span>);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * start = entries_ + indices_[index];</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * end = entries_ + indices_[index + 1];</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * itr = </div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      std::lower_bound(start, end, <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a>(entry),</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        [](<span class="keyword">const</span> <span class="keyword">auto</span> &amp; k1, <span class="keyword">const</span> <span class="keyword">auto</span> &amp; k2) -&gt; <span class="keywordtype">bool</span> {</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;          <span class="keywordflow">return</span> k1.entry &lt; k2.entry;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        });</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    assert(itr != end &amp;&amp; <span class="stringliteral">&quot;sparse accessor: unmapped entry&quot;</span>);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">return</span> itr-&gt;value;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  } <span class="comment">// operator ()</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <a class="code" href="classflecsi_1_1topology_1_1index__space.html">index_space_</a> entries()<span class="keyword"> const</span>{</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordtype">size_t</span> <span class="keywordtype">id</span> = 0;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <a class="code" href="classflecsi_1_1topology_1_1index__space.html">index_space_</a> is;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    std::unordered_set&lt;size_t&gt; found;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> index = 0; index &lt; num_indices_; ++index){</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * itr = entries_ + indices_[index];</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * end = entries_ + indices_[index + 1];</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="keywordflow">while</span>(itr != end){</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordtype">size_t</span> entry = itr-&gt;entry;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">if</span>(found.find(entry) == found.end()){</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;          is.push_back({<span class="keywordtype">id</span>++, entry});</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;          found.insert(entry);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        }</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        ++itr;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">return</span> is;    </div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  }</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <a class="code" href="classflecsi_1_1topology_1_1index__space.html">index_space_</a> entries(<span class="keywordtype">size_t</span> index)<span class="keyword"> const</span>{</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    assert(index &lt; num_indices_ &amp;&amp; <span class="stringliteral">&quot;sparse accessor: index out of bounds&quot;</span>);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * itr = entries_ + indices_[index];</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * end = entries_ + indices_[index + 1];</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <a class="code" href="classflecsi_1_1topology_1_1index__space.html">index_space_</a> is;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordtype">size_t</span> <span class="keywordtype">id</span> = 0;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">while</span>(itr != end){</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      is.push_back({<span class="keywordtype">id</span>++, itr-&gt;entry});</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      ++itr;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    }</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordflow">return</span> is;    </div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  }</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <a class="code" href="classflecsi_1_1topology_1_1index__space.html">index_space_</a> indices(){</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <a class="code" href="classflecsi_1_1topology_1_1index__space.html">index_space_</a> is;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordtype">size_t</span> <span class="keywordtype">id</span> = 0;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; num_indices_; ++i){</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <span class="keywordflow">if</span>(indices_[i] != indices_[i + 1]){</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        is.push_back({<span class="keywordtype">id</span>++, i});</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      }</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    }</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">return</span> is;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  }</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <a class="code" href="classflecsi_1_1topology_1_1index__space.html">index_space_</a> indices(<span class="keywordtype">size_t</span> entry){</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <a class="code" href="classflecsi_1_1topology_1_1index__space.html">index_space_</a> is;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordtype">size_t</span> <span class="keywordtype">id</span> = 0;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> index = 0; index &lt; num_indices_; ++index){</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * start = entries_ + indices_[index];</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * end = entries_ + indices_[index + 1];</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="keywordflow">if</span>(std::binary_search(start, end, <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a>(entry),</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;          [](<span class="keyword">const</span> <span class="keyword">auto</span> &amp; k1, <span class="keyword">const</span> <span class="keyword">auto</span> &amp; k2) -&gt; <span class="keywordtype">bool</span> {</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="keywordflow">return</span> k1.entry &lt; k2.entry;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;          })){</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        is.push_back({<span class="keywordtype">id</span>++, index});</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      }</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    }</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">return</span> is;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordtype">void</span> dump()</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; num_indices_; ++i) {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <span class="keywordtype">size_t</span> start = indices_[i];</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <span class="keywordtype">size_t</span> end = indices_[i + 1];</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      std::cout &lt;&lt; <span class="stringliteral">&quot;+++++ row: &quot;</span> &lt;&lt; i &lt;&lt; std::endl;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j = start; j &lt; end; ++j) {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> &amp; mj = entries_[j];</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;++ entry: &quot;</span> &lt;&lt; mj.entry &lt;&lt; std::endl;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;++ value: &quot;</span> &lt;&lt; mj.value &lt;&lt; std::endl &lt;&lt; std::endl;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      } <span class="comment">// for</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    } <span class="comment">// for</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  } <span class="comment">// dump</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  T *</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  data()</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  } <span class="comment">// data</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keywordtype">size_t</span> version_;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keyword">const</span> meta_data_t &amp; meta_data_ =</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    *(std::make_unique&lt;meta_data_t&gt;());</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keywordtype">size_t</span> num_indices_;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordtype">size_t</span> num_entries_;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="keywordtype">size_t</span> * indices_;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * entries_;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;}; <span class="comment">// struct sparse_accessor_t</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> MD&gt;</div><div class="line"><a name="l00300"></a><span class="lineno"><a class="line" href="structflecsi_1_1data_1_1serial_1_1sparse__mutator__t.html">  300</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structflecsi_1_1data_1_1serial_1_1sparse__mutator__t.html">sparse_mutator_t</a> {</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="comment">//--------------------------------------------------------------------------//</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="comment">// Type definitions.</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="comment">//--------------------------------------------------------------------------//</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  </div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keyword">using</span> <a class="code" href="classflecsi_1_1utils_1_1iterator.html">iterator_t</a> = <a class="code" href="classflecsi_1_1utils_1_1iterator.html">utils::index_space_t::iterator_t</a>;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keyword">using</span> meta_data_t = MD;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="keyword">using</span> user_meta_data_t = <span class="keyword">typename</span> meta_data_t::user_meta_data_t;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="keyword">using</span> <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> = <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value__&lt;T&gt;</a>;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="comment">//--------------------------------------------------------------------------//</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="comment">// Constructors.</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="comment">//--------------------------------------------------------------------------//</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <a class="code" href="structflecsi_1_1data_1_1serial_1_1sparse__mutator__t.html">sparse_mutator_t</a>() {}</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <a class="code" href="structflecsi_1_1data_1_1serial_1_1sparse__mutator__t.html">sparse_mutator_t</a>(</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordtype">size_t</span> num_slots,</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keyword">const</span> std::string &amp; label,</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordtype">size_t</span> version,</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    meta_data_t &amp; meta_data,</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keyword">const</span> user_meta_data_t &amp; user_meta_data</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  )</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  :</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    num_slots_(num_slots),</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    label_(label),</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    version_(version), </div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    meta_data_(meta_data),</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    num_indices_(meta_data_.size),</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    num_entries_(meta_data_.num_entries),</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    indices_(<span class="keyword">new</span> <span class="keywordtype">size_t</span>[num_indices_]),</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    entries_(<span class="keyword">new</span> <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a>[num_indices_ * num_slots_]),</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    erase_set_(<span class="keyword">nullptr</span>)</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  {</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; num_indices_; ++i){</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      indices_[i] = 0;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    }</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  }</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  ~<a class="code" href="structflecsi_1_1data_1_1serial_1_1sparse__mutator__t.html">sparse_mutator_t</a>()</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    commit();</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  } <span class="comment">// ~sparse_mutator_t</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  T &amp;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  operator () (</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordtype">size_t</span> index,</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordtype">size_t</span> entry</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  )</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  {</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    assert(indices_ &amp;&amp; <span class="stringliteral">&quot;sparse mutator has alread been committed&quot;</span>);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    assert(index &lt; num_indices_ &amp;&amp; entry &lt; num_entries_);</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordtype">size_t</span> n = indices_[index];</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">if</span>(n &gt;= num_slots_) {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="keywordflow">return</span> spare_map_.emplace(index,</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a>(entry))-&gt;second.value;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    } <span class="comment">// if</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * start = entries_ + index * num_slots_;     </div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * end = start + n;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * itr = </div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      std::lower_bound(start, end, <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a>(entry),</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        [](<span class="keyword">const</span> <span class="keyword">auto</span> &amp; k1, <span class="keyword">const</span> <span class="keyword">auto</span> &amp; k2) -&gt; <span class="keywordtype">bool</span>{</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;          <span class="keywordflow">return</span> k1.entry &lt; k2.entry;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        });</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="comment">// if we are creating an that has already been created, just </span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="comment">// over-write the value and exit.  No need to increment the </span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="comment">// counters or move data.</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">if</span> ( itr != end &amp;&amp; itr-&gt;entry == entry) {</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      <span class="keywordflow">return</span> itr-&gt;value;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    }</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordflow">while</span>(end != itr) {</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      *(end) = *(end - 1);</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      --end;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    } <span class="comment">// while</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    itr-&gt;entry = entry;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    ++indices_[index];</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">return</span> itr-&gt;value;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  } <span class="comment">// operator ()</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keywordtype">void</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  erase(</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordtype">size_t</span> index,</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordtype">size_t</span> entry</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  )</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    assert(indices_ &amp;&amp; <span class="stringliteral">&quot;sparse mutator has alread been committed&quot;</span>);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    assert(index &lt; num_indices_ &amp;&amp; entry &lt; num_entries_);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keywordflow">if</span>(!erase_set_){</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      erase_set_ = <span class="keyword">new</span> erase_set_t;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    }</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    erase_set_-&gt;emplace(std::make_pair(index, entry));</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  }</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  T *</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  data()</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  {</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  } <span class="comment">// data</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keywordtype">void</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  commit()</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="keywordflow">if</span>(!indices_) {</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    } <span class="comment">// if</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keyword">auto</span> iitr = meta_data_.data.find(version_ | INDICES_FLAG);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    assert(iitr != meta_data_.data.end());</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    std::vector&lt;uint8_t&gt; &amp; raw_indices = </div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="keyword">const_cast&lt;</span>std::vector&lt;uint8_t&gt; &amp;<span class="keyword">&gt;</span>(iitr-&gt;second);</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordtype">size_t</span> * indices = </div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">size_t</span> *<span class="keyword">&gt;</span>(&amp;raw_indices[0]);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keyword">auto</span> mitr = meta_data_.data.find(version_ | ENTRIES_FLAG);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    assert(mitr != meta_data_.data.end());</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    std::vector&lt;uint8_t&gt; &amp; raw_entries = </div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      <span class="keyword">const_cast&lt;</span>std::vector&lt;uint8_t&gt; &amp;<span class="keyword">&gt;</span>(mitr-&gt;second);</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    constexpr <span class="keywordtype">size_t</span> ev_bytes = <span class="keyword">sizeof</span>(<a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a>);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordtype">size_t</span> s = raw_entries.size();</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordtype">size_t</span> c = raw_entries.capacity();</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordtype">size_t</span> d = (num_indices_ * num_slots_ + spare_map_.size()) * ev_bytes;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">if</span>(c - s &lt; d) {</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      <span class="comment">//raw_entries.reserve(c * ev_bytes + d);</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      raw_entries.resize(c * ev_bytes + d);</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    } <span class="comment">// if</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * entries = </div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> *<span class="keyword">&gt;</span>(&amp;raw_entries[0]);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * entries_end = entries + s / ev_bytes;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; num_indices_; ++i) {</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <span class="keywordtype">size_t</span> n = indices_[i];</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      </div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      <span class="keywordtype">size_t</span> pos = indices[i];</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <span class="keywordflow">if</span>(n == 0) {</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        indices[i + 1] = pos;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      } <span class="comment">// if</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      <span class="keyword">auto</span> p = spare_map_.equal_range(i);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      </div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      <span class="keywordtype">size_t</span> m = <a class="code" href="namespaceflecsi.html#a3d6425bc674c81543e3b5f0de15f0b9f">distance</a>(p.first, p.second);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * start = entries_ + i * num_slots_;     </div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * end = start + n; </div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <span class="keyword">auto</span> iitr = entries + pos;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      std::copy(iitr, entries_end, iitr + n + m);</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      std::copy(start, end, iitr);</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      entries_end += n + m;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <span class="keyword">auto</span> cmp = [](<span class="keyword">const</span> <span class="keyword">auto</span> &amp; k1, <span class="keyword">const</span> <span class="keyword">auto</span> &amp; k2) -&gt; <span class="keywordtype">bool</span> {</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordflow">return</span> k1.entry &lt; k2.entry;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      };</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <span class="keyword">auto</span> nitr = iitr + indices[i + 1];</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      std::inplace_merge(iitr, nitr, nitr + n, cmp);</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="keywordflow">if</span>(m == 0) {</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        indices[i + 1] = pos + n;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      } <span class="comment">// if</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      indices[i + 1] = pos + n + m;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <span class="keyword">auto</span> vitr = nitr + n;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      <span class="keywordflow">for</span>(<span class="keyword">auto</span> itr = p.first; itr != p.second; ++itr) {</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        vitr-&gt;entry = itr-&gt;second.entry;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        vitr-&gt;value = itr-&gt;second.value;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        ++vitr;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      } <span class="comment">// for</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      std::inplace_merge(iitr, nitr + n, nitr + n + m, cmp);</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    } <span class="comment">// for</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keyword">delete</span>[] indices_;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    indices_ = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keyword">delete</span>[] entries_;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    entries_ = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordflow">if</span>(!erase_set_){</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    }</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    constexpr <span class="keywordtype">size_t</span> erased_marker = std::numeric_limits&lt;size_t&gt;::max();</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * start; </div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * end;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordtype">size_t</span> last = std::numeric_limits&lt;size_t&gt;::max();</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  </div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordtype">size_t</span> num_erased = 0;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span> p : *erase_set_){</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="keywordflow">if</span>(p.first != last){</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        start = entries + indices[p.first];</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        end = entries + indices[p.first + 1];</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        last = p.first;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        indices[p.first] -= num_erased;      </div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a> * m = </div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        std::lower_bound(start, end, <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value_t</a>(p.second),</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;          [](<span class="keyword">const</span> <span class="keyword">auto</span> &amp; k1, <span class="keyword">const</span> <span class="keyword">auto</span> &amp; k2) -&gt; <span class="keywordtype">bool</span> {</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            return k1.entry &lt; k2.entry;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        });</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      m-&gt;entry = erased_marker;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      start = m + 1;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      ++num_erased;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    }</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordflow">while</span>(last &lt; num_indices_){</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      indices[++last] -= num_erased;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    }</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    std::remove_if(entries, entries_end,</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      [](<span class="keyword">const</span> <span class="keyword">auto</span> &amp; k) -&gt; <span class="keywordtype">bool</span> {</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="keywordflow">return</span> k.entry == erased_marker;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    });</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    s = raw_entries.size();</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    s -= num_erased * ev_bytes;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    raw_entries.resize(s);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keyword">delete</span> erase_set_;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    erase_set_ = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  } <span class="comment">// commit</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="keyword">using</span> spare_map_t = std::multimap&lt;size_t, entry_value__&lt;T&gt;&gt;;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="keyword">using</span> erase_set_t = std::set&lt;std::pair&lt;size_t, size_t&gt;&gt;;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="keywordtype">size_t</span> num_slots_;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  std::string label_ = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="keywordtype">size_t</span> version_ = 0;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keyword">const</span> meta_data_t &amp; meta_data_ =</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    *(std::make_unique&lt;meta_data_t&gt;());</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    </div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <span class="keywordtype">size_t</span> num_indices_;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="keywordtype">size_t</span> num_entries_;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keywordtype">size_t</span> * indices_;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <a class="code" href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">entry_value__&lt;T&gt;</a> * entries_;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  spare_map_t spare_map_;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  erase_set_t * erase_set_;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;}; <span class="comment">// struct sparse_accessor_t</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">//----------------------------------------------------------------------------//</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">// Sparse handle.</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">//----------------------------------------------------------------------------//</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><a name="l00587"></a><span class="lineno"><a class="line" href="structflecsi_1_1data_1_1serial_1_1sparse__handle__t.html">  587</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structflecsi_1_1data_1_1serial_1_1sparse__handle__t.html">sparse_handle_t</a> {</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;}; <span class="comment">// struct sparse_handle_t</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">//+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=//</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">// Main type definition.</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">//+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=//</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">// FIXME: Sparse storage type.</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment"></span><span class="keyword">template</span>&lt;<span class="keyword">typename</span> DS, <span class="keyword">typename</span> MD&gt;</div><div class="line"><a name="l00598"></a><span class="lineno"><a class="line" href="structflecsi_1_1data_1_1serial_1_1storage__type__t_3_01sparse_00_01DS_00_01MD_01_4.html">  598</a></span>&#160;<span class="keyword">struct </span>storage_type_t&lt;sparse, DS, MD&gt; {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <span class="comment">//--------------------------------------------------------------------------//</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <span class="comment">// Type definitions.</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  <span class="comment">//--------------------------------------------------------------------------//</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="keyword">using</span> data_store_t = DS;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="keyword">using</span> meta_data_t = MD;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="keyword">using</span> <a class="code" href="structflecsi_1_1data_1_1serial_1_1sparse__accessor__t.html">accessor_t</a> = <a class="code" href="structflecsi_1_1data_1_1serial_1_1sparse__accessor__t.html">sparse_accessor_t&lt;T, MD&gt;</a>;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <span class="keyword">using</span> <a class="code" href="structflecsi_1_1data_1_1serial_1_1sparse__mutator__t.html">mutator_t</a> = <a class="code" href="structflecsi_1_1data_1_1serial_1_1sparse__mutator__t.html">sparse_mutator_t&lt;T, MD&gt;</a>;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <span class="keyword">using</span> <a class="code" href="structflecsi_1_1data_1_1serial_1_1sparse__handle__t.html">handle_t</a> = <a class="code" href="structflecsi_1_1data_1_1serial_1_1sparse__handle__t.html">sparse_handle_t&lt;T&gt;</a>;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="comment">//--------------------------------------------------------------------------//</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <span class="comment">// Data registration.</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="comment">//--------------------------------------------------------------------------//</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="keyword">template</span>&lt;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keyword">typename</span> T,</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordtype">size_t</span> NS,</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keyword">typename</span> ... Args</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  &gt;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="keyword">static</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <a class="code" href="structflecsi_1_1data_1_1serial_1_1sparse__handle__t.html">handle_t&lt;T&gt;</a></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  register_data(</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keyword">const</span> <a class="code" href="classflecsi_1_1data_1_1data__client__t.html">data_client_t</a> &amp; data_client,</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    data_store_t &amp; data_store,</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keyword">const</span> <a class="code" href="classflecsi_1_1utils_1_1const__string__t.html">utils::const_string_t</a> &amp; key,</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordtype">size_t</span> versions,</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="classindex__space.html">index_space</a>,</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordtype">size_t</span> num_entries,</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    Args &amp;&amp; ... args</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  )</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordtype">size_t</span> h = key.hash() ^ data_client.<a class="code" href="classflecsi_1_1data_1_1data__client__t.html#a69e2d5af6d27a1cc1e0cf224d3181612">runtime_id</a>();</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="comment">// Runtime assertion that this key is unique</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    assert(data_store[NS].find(h) == data_store[NS].end() &amp;&amp;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="stringliteral">&quot;key already exists&quot;</span>);</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    meta_data_t &amp; md = data_store[NS][h];</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    md.user_data.initialize(std::forward&lt;Args&gt;(args) ...);</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    md.label = key.c_str();</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    md.size = data_client.indices(index_space);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    md.type_size = <span class="keyword">sizeof</span>(T);</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    md.versions = versions;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    md.rtti.reset(</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <span class="keyword">new</span> <span class="keyword">typename</span> meta_data_t::type_info_t(<span class="keyword">typeid</span>(T)));</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    md.num_entries = num_entries;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> version = 0; version &lt; versions; ++version){</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      <span class="keyword">auto</span> &amp; iv = md.data[version | INDICES_FLAG] = std::vector&lt;uint8_t&gt;();</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      iv.resize((data_client.indices(index_space) + 1) * <span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>));</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      md.data[version | ENTRIES_FLAG] = std::vector&lt;uint8_t&gt;();</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    }</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordflow">return</span> {};</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  } <span class="comment">// register_data</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="keyword">template</span>&lt;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keyword">typename</span> T,</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="keywordtype">size_t</span> NS</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  &gt;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  <span class="keyword">static</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <a class="code" href="structflecsi_1_1data_1_1serial_1_1sparse__accessor__t.html">accessor_t&lt;T&gt;</a></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  get_accessor(</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keyword">const</span> <a class="code" href="classflecsi_1_1data_1_1data__client__t.html">data_client_t</a> &amp; data_client,</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    data_store_t &amp; data_store,</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keyword">const</span> <a class="code" href="classflecsi_1_1utils_1_1const__string__t.html">utils::const_string_t</a> &amp; key,</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordtype">size_t</span> version</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  )</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  {</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> h = key.hash() ^ data_client.<a class="code" href="classflecsi_1_1data_1_1data__client__t.html#a69e2d5af6d27a1cc1e0cf224d3181612">runtime_id</a>();</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keyword">auto</span> search = data_store[NS].find(h);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">if</span>(search == data_store[NS].end()) {</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      <span class="keywordflow">return</span> {};</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    }</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      <span class="keyword">auto</span> &amp; meta_data = search-&gt;second;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <span class="comment">// check that the requested version exists</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      assert(meta_data.versions &gt; version &amp;&amp; <span class="stringliteral">&quot;version out-of-range&quot;</span>);</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="keywordflow">return</span> { meta_data, version };</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    } <span class="comment">// if</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  } <span class="comment">// get_accessor</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <span class="keyword">template</span>&lt;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keyword">typename</span> T,</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keywordtype">size_t</span> NS</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  &gt;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="keyword">static</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <a class="code" href="structflecsi_1_1data_1_1serial_1_1sparse__mutator__t.html">mutator_t&lt;T&gt;</a></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  get_mutator(</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keyword">const</span> <a class="code" href="classflecsi_1_1data_1_1data__client__t.html">data_client_t</a> &amp; data_client,</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    data_store_t &amp; data_store,</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keyword">const</span> <a class="code" href="classflecsi_1_1utils_1_1const__string__t.html">utils::const_string_t</a> &amp; key,</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="keywordtype">size_t</span> slots,</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="keywordtype">size_t</span> version</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  )</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  {</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> h = key.hash() ^ data_client.<a class="code" href="classflecsi_1_1data_1_1data__client__t.html#a69e2d5af6d27a1cc1e0cf224d3181612">runtime_id</a>();</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keyword">auto</span> search = data_store[NS].find(h);</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordflow">if</span>(search == data_store[NS].end()) {</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      <span class="keywordflow">return</span> {};</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    }</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      <span class="keyword">auto</span> &amp; meta_data = search-&gt;second;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      <span class="comment">// check that the requested version exists</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      assert(meta_data.versions &gt; version &amp;&amp; <span class="stringliteral">&quot;version out-of-range&quot;</span>);</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <span class="keywordflow">return</span> { slots, meta_data.label, version, meta_data,</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        meta_data.user_data };</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    } <span class="comment">// if</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  } <span class="comment">// get_accessor</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <span class="keyword">template</span>&lt;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="keyword">typename</span> T,</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keywordtype">size_t</span> NS</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  &gt;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <span class="keyword">static</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <a class="code" href="structflecsi_1_1data_1_1serial_1_1sparse__handle__t.html">handle_t&lt;T&gt;</a></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  get_handle(</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keyword">const</span> <a class="code" href="classflecsi_1_1data_1_1data__client__t.html">data_client_t</a> &amp; data_client,</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    data_store_t &amp; data_store,</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="keyword">const</span> <a class="code" href="classflecsi_1_1utils_1_1const__string__t.html">utils::const_string_t</a> &amp; key,</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="keywordtype">size_t</span> version</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  )</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  {</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="keywordflow">return</span> {};</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  } <span class="comment">// get_handle</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;}; <span class="comment">// struct storage_type_t</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;} <span class="comment">// namespace serial</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;} <span class="comment">// namespace data</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;} <span class="comment">// namespace flecsi</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="preprocessor">#endif // flecsi_serial_sparse_h</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment">/*~-------------------------------------------------------------------------~-*</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment"> * Formatting options</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment"> * vim: set tabstop=2 shiftwidth=2 expandtab :</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment"> *~-------------------------------------------------------------------------~-*/</span></div><div class="ttc" id="classindex__space_html"><div class="ttname"><a href="classindex__space.html">index_space</a></div><div class="ttdoc">index_space provides... </div></div>
<div class="ttc" id="structflecsi_1_1data_1_1serial_1_1sparse__mutator__t_html"><div class="ttname"><a href="structflecsi_1_1data_1_1serial_1_1sparse__mutator__t.html">flecsi::data::serial::sparse_mutator_t</a></div><div class="ttdef"><b>Definition:</b> sparse.h:300</div></div>
<div class="ttc" id="classflecsi_1_1topology_1_1index__space_html"><div class="ttname"><a href="classflecsi_1_1topology_1_1index__space.html">flecsi::topology::index_space</a></div><div class="ttdoc">index_space provides a compile-time configurable and iterable container of objects, e.g. mesh/tree topology entities and their id&amp;#39;s. Index space defines the concept of STORAGE - whether the actual entities referenced are stored within this index space OR contained in a &amp;#39;master&amp;#39; index space. OWNERSHIP - whether its set of id&amp;#39;s are owned by this index space or aliased to another index space and then mustcbe copied before this index space can then modify them. SORTED - refers to if the id&amp;#39;s are sorted and can then have set operations directly applied to them, else the index space must first be sorted. To make operations on index spaces faster, the index space is parameterized on a number of these parameters and can be efficiently recast depending on how it is to be used: STORAGE - if true then this is a &amp;#39;master&amp;#39; index space with its own storage. OWNED - if true then id ownership is definitely true, else must check owned_ at runtime. SORTED - if true then id&amp;#39;s are definitely stored and shall remain in sorted order. </div><div class="ttdef"><b>Definition:</b> index_space.h:46</div></div>
<div class="ttc" id="structflecsi_1_1data_1_1serial_1_1entry__value_____html"><div class="ttname"><a href="structflecsi_1_1data_1_1serial_1_1entry__value____.html">flecsi::data::serial::entry_value__</a></div><div class="ttdef"><b>Definition:</b> sparse.h:61</div></div>
<div class="ttc" id="classflecsi_1_1utils_1_1const__string__t_html"><div class="ttname"><a href="classflecsi_1_1utils_1_1const__string__t.html">flecsi::utils::const_string_t</a></div><div class="ttdef"><b>Definition:</b> const_string.h:37</div></div>
<div class="ttc" id="classflecsi_1_1data_1_1data__client__t_html"><div class="ttname"><a href="classflecsi_1_1data_1_1data__client__t.html">flecsi::data::data_client_t</a></div><div class="ttdoc">data_client_t provides... </div><div class="ttdef"><b>Definition:</b> data_client.h:26</div></div>
<div class="ttc" id="classflecsi_1_1utils_1_1iterator_html"><div class="ttname"><a href="classflecsi_1_1utils_1_1iterator.html">flecsi::utils::iterator</a></div><div class="ttdoc">iterator provides... </div><div class="ttdef"><b>Definition:</b> iterator.h:31</div></div>
<div class="ttc" id="structflecsi_1_1data_1_1serial_1_1sparse__handle__t_html"><div class="ttname"><a href="structflecsi_1_1data_1_1serial_1_1sparse__handle__t.html">flecsi::data::serial::sparse_handle_t</a></div><div class="ttdef"><b>Definition:</b> sparse.h:587</div></div>
<div class="ttc" id="const__string_8h_html"><div class="ttname"><a href="const__string_8h.html">const_string.h</a></div></div>
<div class="ttc" id="classflecsi_1_1data_1_1data__client__t_html_a69e2d5af6d27a1cc1e0cf224d3181612"><div class="ttname"><a href="classflecsi_1_1data_1_1data__client__t.html#a69e2d5af6d27a1cc1e0cf224d3181612">flecsi::data::data_client_t::runtime_id</a></div><div class="ttdeci">uintptr_t runtime_id() const </div><div class="ttdef"><b>Definition:</b> data_client.h:53</div></div>
<div class="ttc" id="storage__type_8h_html"><div class="ttname"><a href="storage__type_8h.html">storage_type.h</a></div></div>
<div class="ttc" id="structflecsi_1_1data_1_1serial_1_1sparse__accessor__t_html"><div class="ttname"><a href="structflecsi_1_1data_1_1serial_1_1sparse__accessor__t.html">flecsi::data::serial::sparse_accessor_t</a></div><div class="ttdoc">sparse_accessor_t provides logically array-based access to data variables that have been registered i...</div><div class="ttdef"><b>Definition:</b> sparse.h:92</div></div>
<div class="ttc" id="namespaceflecsi_html"><div class="ttname"><a href="namespaceflecsi.html">flecsi</a></div><div class="ttdef"><b>Definition:</b> thread_pool.h:37</div></div>
<div class="ttc" id="namespaceflecsi_html_a3d6425bc674c81543e3b5f0de15f0b9f"><div class="ttname"><a href="namespaceflecsi.html#a3d6425bc674c81543e3b5f0de15f0b9f">flecsi::distance</a></div><div class="ttdeci">T distance(const point&lt; T, D &gt; &amp;a, const point&lt; T, D &gt; &amp;b)</div><div class="ttdef"><b>Definition:</b> point.h:58</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
