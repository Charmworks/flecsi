<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" type="image/x-icon" href="flecsi-favicon.ico" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>Interface Documentation: Design Pattern: Curiously Recurring Template Pattern (CRTP)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" height="200" style="margin-top:40px; margin-left:30px; margin-right:10px" src="medium-flecsi.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Interface Documentation<br>
		<span id="projectnumber">Version:</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Design Pattern: Curiously Recurring Template Pattern (CRTP) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>More generally known as F-bound polymorphism, this idiom was formalized in the 1980s. The name <em>CRTP</em> was coined by Jim Coplien in 1995. The wikipedia entry is <a href="https://en.wikipedia.org/wiki/Curiously_recurring_template_pattern">here</a>.</p>
<p>The general form of the pattern involves a templated base class and a derived class that specializes the base class with its own type:</p>
<div class="fragment"><div class="line">template&lt;</div><div class="line">  typename CRTP_TYPE</div><div class="line">&gt;</div><div class="line">struct base__ {</div><div class="line">}; // struct base__</div><div class="line"></div><div class="line">struct derived__ : public base__&lt;derived__&gt; // This is the important bit.</div><div class="line">{</div><div class="line">}; // struct derived__</div></div><!-- fragment --><p>One use of this pattern in FleCSI is for static polymorphism. In particular, by statically casting the base type to the derived type, we can allow the derived type to specialize the behavior of the base class interface. In the following code example, <em>tuple_walker__</em> is the base class for a derived type identified by <em>CRTP_TYPE</em>:</p>
<div class="fragment"><div class="line">template&lt;</div><div class="line">  typename CRTP_TYPE</div><div class="line">&gt;</div><div class="line">struct tuple_walker__</div><div class="line">{</div><div class="line">  // In this example, we employ a helper type to walk a tuple and</div><div class="line">  // apply the handler method defined by the derived type.</div><div class="line">  template&lt;</div><div class="line">    typename TUPLE_TYPE</div><div class="line">  &gt;</div><div class="line">  void walk(</div><div class="line">    TUPLE_TYPE &amp; t</div><div class="line">  )</div><div class="line">  {</div><div class="line">    using HELPER_TYPE =</div><div class="line">      tuple_walker_helper__&lt;</div><div class="line">        std::tuple_size&lt;TUPLE_TYPE&gt;::value,</div><div class="line">        TUPLE_TYPE,</div><div class="line">        CRTP_TYPE</div><div class="line">      &gt;;</div><div class="line"></div><div class="line">    // CRTP is needed here to recover the derived type&#39;s type</div><div class="line">    // for this static cast.</div><div class="line">    HELPER_TYPE::walk(*static_cast&lt;CRTP_TYPE*&gt;(this), t);</div><div class="line">  } // walk</div><div class="line">}; // struct tuple_walker__</div></div><!-- fragment --><p>The helper class calls the handle method:</p>
<div class="fragment"><div class="line">template&lt;</div><div class="line">  std::size_t INDEX,</div><div class="line">  typename TUPLE_TYPE,</div><div class="line">  typename CRTP_TYPE</div><div class="line">&gt;</div><div class="line">struct tuple_walker_helper__</div><div class="line">{</div><div class="line">  // The walk method of the helper class calls the CRTP type&#39;s</div><div class="line">  // handle method.</div><div class="line">  static</div><div class="line">  std::size_t</div><div class="line">  walk(</div><div class="line">    CRTP_TYPE &amp; p,</div><div class="line">    TUPLE_TYPE &amp; t</div><div class="line">  )</div><div class="line">  {</div><div class="line">    p.handle(std::get&lt;CURRENT&gt;(t));</div><div class="line">    return HELPER_TYPE::walk(p, t);</div><div class="line">  } // walk</div><div class="line">}; // tuple_walker_helper__</div></div><!-- fragment --><p>The <em>p.handle</em> method, defined by the <em>CRTP_TYPE</em>, allows the derived type to apply specialized logic to each element type of the <em>TUPLE_TYPE</em>.</p>
<p>Several other uses of CRTP are documented on <a href="https://en.wikipedia.org/wiki/Curiously_recurring_template_pattern">widipedia</a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
