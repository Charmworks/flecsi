<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" type="image/x-icon" href="flecsi-favicon.ico" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Interface Documentation: Design Pattern: Curiously Recurring Template Pattern (CRTP)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" height="200" style="margin-top:40px; margin-left:30px; margin-right:10px" src="medium-flecsi.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Interface Documentation<br>
		<span id="projectnumber">Version:</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Design Pattern: Curiously Recurring Template Pattern (CRTP) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>More generally known as F-bound polymorphism, this idiom was formalized in the 1980s. The name <em>CRTP</em> was coined by Jim Coplien in 1995. The wikipedia entry is <a href="https://en.wikipedia.org/wiki/Curiously_recurring_template_pattern">here</a>.</p>
<p>The general form of the pattern involves a templated base class and a derived class that specializes the base class with its own type:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;template&lt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  typename CRTP_TYPE</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;struct base__ {</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;}; // struct base__</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;struct derived__ : public base__&lt;derived__&gt; // This is the important bit.</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;{</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;}; // struct derived__</div></div><!-- fragment --><p>One use of this pattern in FleCSI is for static polymorphism. In particular, by statically casting the base type to the derived type, we can allow the derived type to specialize the behavior of the base class interface. In the following code example, <em>tuple_walker__</em> is the base class for a derived type identified by <em>CRTP_TYPE</em>:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;template&lt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  typename CRTP_TYPE</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;struct tuple_walker__</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;{</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  // In this example, we employ a helper type to walk a tuple and</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  // apply the handler method defined by the derived type.</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  template&lt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    typename TUPLE_TYPE</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  void walk(</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    TUPLE_TYPE &amp; t</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  )</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  {</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    using HELPER_TYPE =</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;      tuple_walker_helper__&lt;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        std::tuple_size&lt;TUPLE_TYPE&gt;::value,</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        TUPLE_TYPE,</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;        CRTP_TYPE</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;      &gt;;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    // CRTP is needed here to recover the derived type&#39;s type</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    // for this static cast.</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    HELPER_TYPE::walk(*static_cast&lt;CRTP_TYPE*&gt;(this), t);</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  } // walk</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;}; // struct tuple_walker__</div></div><!-- fragment --><p>The helper class calls the handle method:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;template&lt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  std::size_t INDEX,</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  typename TUPLE_TYPE,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  typename CRTP_TYPE</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;struct tuple_walker_helper__</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  // The walk method of the helper class calls the CRTP type&#39;s</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  // handle method.</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  static</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  std::size_t</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  walk(</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    CRTP_TYPE &amp; p,</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    TUPLE_TYPE &amp; t</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  )</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  {</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    p.handle(std::get&lt;CURRENT&gt;(t));</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    return HELPER_TYPE::walk(p, t);</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  } // walk</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;}; // tuple_walker_helper__</div></div><!-- fragment --><p>The <em>p.handle</em> method, defined by the <em>CRTP_TYPE</em>, allows the derived type to apply specialized logic to each element type of the <em>TUPLE_TYPE</em>.</p>
<p>Several other uses of CRTP are documented on <a href="https://en.wikipedia.org/wiki/Curiously_recurring_template_pattern">widipedia</a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
