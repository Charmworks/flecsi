<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" type="image/x-icon" href="flecsi-favicon.ico" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>Interface Documentation: FleCSI: Tutorial - 05 Sparse Data</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" height="200" style="margin-top:40px; margin-left:30px; margin-right:10px" src="medium-flecsi.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Interface Documentation<br>
		<span id="projectnumber">Version:</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">FleCSI: Tutorial - 05 Sparse Data </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Sparse Data</h1>
<p>The FleCSI sparse storage class allows the representation of sparse data fields, i.e., fields on which zero, one or more data may be defined at each index of the associated index space. The sparse storage class is suitable for representing sparse matrices, sparse materials, or any other logical data structure that utilizes a compressed storage appraoch. <em>Note that although the current implementation does use a compressed storage scheme, there is no guaruntee that this will be the case.</em> The sparse storage class defines the interface to the registered field data, not the storage mechanism.</p>
<p>Sparse storage differs from simple contiguous data in that, not only are the data at each index mutable, but the sparsity pattern of the data is also mutable. Modifying the sparsity pattern of the data is a more expensive operation than simply modifying the values of existing sparse data. To allow for more efficient access patterns, FleCSI splits operations that mutate the sparsity pattern from those that only modify the data (without changing the sparsity pattern). Access to these is defined using separate types:</p>
<ol type="1">
<li>A mutator allows <em>both</em> modification of the sparsity structure and of the data values.</li>
<li>A handle only allows modification to the data values.</li>
</ol>
<p>The data handle interface is the same as for <em>dense</em> data. For the mutator, the user must specify an additional argument that declares how many slots should be pre-allocated for adding new non-sparse entries: </p><div class="fragment"><div class="line">                                                                  v</div><div class="line"><span class="keyword">auto</span> f = <a class="code" href="group__data.html#ga2dfcb60015003658907f2be2e648b36c">flecsi_get_mutator</a>(m, <a class="code" href="namespaceexample.html">example</a>, field, <span class="keywordtype">double</span>, sparse, 0, 5);</div></div><!-- fragment --><p> This argument is only a hint to the runtime: Slots added within this allocation will be more efficient than those that exceed the allocation. However, both operations will be correct, i.e., if the user has specified 5 additional slots, but adds 6 non-sparse entries, the program will still operate correctly. (FleCSI uses an overflow buffer to manage additional entries that exceed the slot allocation.)</p>
<p>NOTES:</p>
<ul>
<li>Tasks that do not need to mutate the sparsity structure should always use an <em>handle</em> rather than a <em>mutator</em> for efficiency.</li>
<li>We are investigating design changes that will allow specialization developers to add new storage classes and storage class implementations.</li>
</ul>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;cstdlib&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include&lt;flecsi-tutorial/specialization/mesh/mesh.h&gt;</span></div><div class="line"><span class="preprocessor">#include&lt;<a class="code" href="data_8h.html">flecsi/data/data.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include&lt;<a class="code" href="execution_8h.html">flecsi/execution/execution.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceflecsi.html">flecsi</a>;</div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceflecsi_1_1tutorial.html">flecsi::tutorial</a>;</div><div class="line"></div><div class="line"><span class="comment">// Field registration is as usual (but specifying the &#39;sparse&#39;</span></div><div class="line"><span class="comment">// storage class).</span></div><div class="line"></div><div class="line"><a class="code" href="group__data.html#ga94367ffbedff524f08ddef3a27df2b36">flecsi_register_field</a>(<a class="code" href="structflecsi_1_1tutorial_1_1specialization__mesh__t.html">mesh_t</a>, <a class="code" href="namespaceexample.html">example</a>, <a class="code" href="structflecsi_1_1accessor__u_3_01data_1_1dense_00_01T_00_01EXCLUSIVE__PERMISSIONS_00_01SHARED__PEb133ab9348c8454ebc6464fc890c46f5.html">field</a>, <span class="keywordtype">double</span>, sparse, 1, cells);</div><div class="line"></div><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceexample.html">example</a> {</div><div class="line"></div><div class="line"><span class="comment">// This task takes a mesh and a sparse mutator and randomly populates</span></div><div class="line"><span class="comment">// field entries into the sparse field structure.</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> initialize_sparse_field(<a class="code" href="structflecsi_1_1data__client__handle__base__u.html">mesh&lt;ro&gt;</a> mesh, <a class="code" href="structflecsi_1_1mutator__u_3_01data_1_1sparse_00_01T_01_4.html">sparse_field_mutator</a> f) {</div><div class="line"></div><div class="line">  <span class="keywordflow">for</span>(<span class="keyword">auto</span> c: mesh.cells()) {</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> random = (rand()/<span class="keywordtype">double</span>{RAND_MAX}) * 5;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i{0}; i&lt;random; ++i) {</div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">size_t</span> entry = (rand()/<span class="keywordtype">double</span>{RAND_MAX}) * 5;</div><div class="line"></div><div class="line">      <span class="comment">// Note that the field operator () takes a cell index and</span></div><div class="line">      <span class="comment">// an entry. This provides logically dense access to sparsley</span></div><div class="line">      <span class="comment">// stored data.</span></div><div class="line"></div><div class="line">      f(c, entry) = entry;</div><div class="line"></div><div class="line">    } <span class="comment">// for</span></div><div class="line">  } <span class="comment">// for</span></div><div class="line">} <span class="comment">// initialize_pressure</span></div><div class="line"></div><div class="line"><a class="code" href="group__execution.html#ga4dcd75ac370388c816b99672d589c4bc">flecsi_register_task</a>(initialize_sparse_field, <a class="code" href="namespaceexample.html">example</a>, loc, single);</div><div class="line"></div><div class="line"><span class="comment">// This task prints the non-zero entries of the sparse field.</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> print_sparse_field(<a class="code" href="structflecsi_1_1data__client__handle__base__u.html">mesh&lt;ro&gt;</a> mesh, <a class="code" href="structflecsi_1_1accessor__u_3_01data_1_1sparse_00_01T_00_01EXCLUSIVE__PERMISSIONS_00_01SHARED__Pa1e9cbf455137975651d6e620bfc272d.html">sparse_field&lt;ro&gt;</a> f) {</div><div class="line">  <span class="keywordflow">for</span>(<span class="keyword">auto</span> c: mesh.cells()) {</div><div class="line">    <span class="keywordflow">for</span>(<span class="keyword">auto</span> m: f.<a class="code" href="structflecsi_1_1accessor__u_3_01data_1_1sparse_00_01T_00_01EXCLUSIVE__PERMISSIONS_00_01SHARED__Pa1e9cbf455137975651d6e620bfc272d.html#a77b6f54d88212a9a21285e147afd7fcf">entries</a>(c)) {</div><div class="line">      std::cout &lt;&lt; f(c,m) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div><div class="line">    } <span class="comment">// for</span></div><div class="line">    std::cout &lt;&lt; std::endl;</div><div class="line">  } <span class="comment">// for</span></div><div class="line">} <span class="comment">// print_pressure</span></div><div class="line"></div><div class="line"><a class="code" href="group__execution.html#ga4dcd75ac370388c816b99672d589c4bc">flecsi_register_task</a>(print_sparse_field, <a class="code" href="namespaceexample.html">example</a>, loc, single);</div><div class="line"></div><div class="line">} <span class="comment">// namespace example</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceflecsi.html">flecsi</a> {</div><div class="line"><span class="keyword">namespace </span>execution {</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="hpx_2runtime__driver_8h.html#a529faee76b6bf740ce1a013919b3654f">driver</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv) {</div><div class="line"></div><div class="line">  <span class="comment">// Get a handle to the mesh</span></div><div class="line"></div><div class="line">  <span class="keyword">auto</span> m = <a class="code" href="group__data.html#ga9673dfe687ab0a65683d20689bd9cc46">flecsi_get_client_handle</a>(<a class="code" href="structflecsi_1_1tutorial_1_1specialization__mesh__t.html">mesh_t</a>, clients, mesh);</div><div class="line"></div><div class="line">  {</div><div class="line">  <span class="comment">// Get a mutator to modify the sparsity structure of the data.</span></div><div class="line"></div><div class="line">  <span class="keyword">auto</span> f = <a class="code" href="group__data.html#ga2dfcb60015003658907f2be2e648b36c">flecsi_get_mutator</a>(m, <a class="code" href="namespaceexample.html">example</a>, <a class="code" href="structflecsi_1_1accessor__u_3_01data_1_1dense_00_01T_00_01EXCLUSIVE__PERMISSIONS_00_01SHARED__PEb133ab9348c8454ebc6464fc890c46f5.html">field</a>, <span class="keywordtype">double</span>, sparse, 0, 5);</div><div class="line"></div><div class="line">  <a class="code" href="group__execution.html#gafca967e833f6d2dffd7d326c5993964f">flecsi_execute_task</a>(initialize_sparse_field, <a class="code" href="namespaceexample.html">example</a>, single, m, f);</div><div class="line">  } <span class="comment">// scope</span></div><div class="line"></div><div class="line">  {</div><div class="line">  <span class="comment">// Get a handle to modify only the values of the data.</span></div><div class="line"></div><div class="line">  <span class="keyword">auto</span> f = <a class="code" href="group__data.html#gaa8a47aa981f998c81433eece3206e5f0">flecsi_get_handle</a>(m, <a class="code" href="namespaceexample.html">example</a>, <a class="code" href="structflecsi_1_1accessor__u_3_01data_1_1dense_00_01T_00_01EXCLUSIVE__PERMISSIONS_00_01SHARED__PEb133ab9348c8454ebc6464fc890c46f5.html">field</a>, <span class="keywordtype">double</span>, sparse, 0);</div><div class="line"></div><div class="line">  <a class="code" href="group__execution.html#gafca967e833f6d2dffd7d326c5993964f">flecsi_execute_task</a>(print_sparse_field, <a class="code" href="namespaceexample.html">example</a>, single, m, f);</div><div class="line">  } <span class="comment">// scope</span></div><div class="line"></div><div class="line">} <span class="comment">// driver</span></div><div class="line"></div><div class="line">} <span class="comment">// namespace execution</span></div><div class="line">} <span class="comment">// namespace flecsi</span></div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
